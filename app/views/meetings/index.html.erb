<% title "All The District 19 AA Meetings" %>


<script>
function initialize() {
  
  var locations = <%= @all_results.to_s.html_safe %>
  var boxList =[];
  
  var mapOptions = {
    // zoom: 9,
    center: new google.maps.LatLng(<%= @map_location.latitude %>, <%= @map_location.longitude %>),
    mapTypeControl: false,
    zoomControl: true,
    zoomControlOptions: {
      style: google.maps.ZoomControlStyle.SMALL
    },
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  var map = new google.maps.Map(document.getElementById('map-canvas'),
                                mapOptions);
                                  
  
  
  // ==========
  // = Bounds =
  // ==========
  var LatLngList = new Array ();
  var bounds = new google.maps.LatLngBounds();
  
  for (i = 0; i < locations.length; i++) {  
    LatLngList.push( new google.maps.LatLng(locations[i].latitude, locations[i].longitude) )
    bounds.extend (LatLngList[i]);
  }
  map.fitBounds (bounds);
  
  // ===========
  // = Markers =
  // ===========
  var marker
  var image = '<%= asset_path "aa-map-marker.png" %>';
  var i;
  
  // http://gmaps-samples-v3.googlecode.com/svn/trunk/infowindow_custom/infowindow-custom.html
  // http://stackoverflow.com/questions/8881577/google-map-api-infobox-and-for-loop
  var infowindow = new google.maps.InfoWindow(); // info windows
  
  for (i = 0; i < locations.length; i++) {  
    // plot the markers
    marker = new google.maps.Marker({
      position: new google.maps.LatLng(locations[i].latitude, locations[i].longitude),
      map: map,
      id: i,
      title: locations[i].title,
      icon: image
    });
    
    var boxText = document.createElement("div");
    boxText.id = i;
    boxText.style.cssText = "border: 1px solid black; margin-top: 8px; background: yellow; padding: 5px;";
    boxText.innerHTML = "InfoBox for " + locations[i].title;

    var myOptions = {
        content: boxText
        ,disableAutoPan: false
        ,maxWidth: 0
        ,pixelOffset: new google.maps.Size(-140, 0)
        ,zIndex: null
        ,boxStyle: {
            background: "url('tipbox.gif') no-repeat"
            ,opacity: 0.75
            ,width: "280px"
        }
        ,closeBoxMargin: "10px 2px 2px 2px"
        ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
        ,infoBoxClearance: new google.maps.Size(1, 1)
        ,isHidden: false
        ,pane: "floatPane"
        ,enableEventPropagation: false
    };

    var ib = new InfoBox(myOptions);
    boxList.push(ib);

    // google.maps.event.addListener(marker,'click',(function(marker, i) {
    //     return function() {
    //         boxList[i].open(map, this);
    //     }
    // })(marker, i));

    // google.maps.event.addDomListener(boxList[i].content_,'click',(function(marker, i) {
    //            return function() {
    //              alert('clicked ' + cityList[i][0])
    //            }
    //          })(marker, i));
            
    // add listener for popup
    google.maps.event.addListener(marker, 'click', (function(marker, i) {
      return function() {
        // infowindow.setContent('<div id="infoWindowContent"><h3>'+locations[i].address + '</h3><p>'+ locations[i].distance +'</p></div>');
        //         infowindow.open(map, marker);
        boxList[i].open(map, this);
      }
    })(marker, i));
    
     google.maps.event.addDomListener(boxList[i].content_,'click',(function(marker, i) {
              return function() {
                alert('clicked ' + cityList[i].title)
              }
            })(marker, i));
  }
  
}

google.maps.event.addDomListener(window, 'load', initialize);

// var cityList = [
//     ['Chicago', 41.850033, -87.6500523, 1],
//     ['Illinois', 40.797177,-89.406738, 2]
//     ];
// 
//     var demoCenter = new google.maps.LatLng(41,-87);
//     var boxList =[];
// 
//     function initialize() {
//         map = new google.maps.Map(document.getElementById('map-canvas'), {
//             zoom: 7,
//             center: demoCenter,
//             mapTypeId: google.maps.MapTypeId.ROADMAP
//         });
//         addMarkers();
//     }
// 
//     function addMarkers(){
//         for (var i = 0; i < cityList.length; i++)
//         {
//             marker = new google.maps.Marker({
//                 position: new google.maps.LatLng(cityList[i][1], cityList[i][2]),
//                 map: map,
//                 id: i,
//                 title: cityList[i][0]
//             });         
// 
//             var boxText = document.createElement("div");
//             boxText.id = i;
//             boxText.style.cssText = "border: 1px solid black; margin-top: 8px; background: yellow; padding: 5px;";
//             boxText.innerHTML = "InfoBox for " + cityList[i][0];
// 
//             var myOptions = {
//                 content: boxText
//                 ,disableAutoPan: false
//                 ,maxWidth: 0
//                 ,pixelOffset: new google.maps.Size(-140, 0)
//                 ,zIndex: null
//                 ,boxStyle: {
//                     background: "url('tipbox.gif') no-repeat"
//                     ,opacity: 0.75
//                     ,width: "280px"
//                 }
//                 ,closeBoxMargin: "10px 2px 2px 2px"
//                 ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
//                 ,infoBoxClearance: new google.maps.Size(1, 1)
//                 ,isHidden: false
//                 ,pane: "floatPane"
//                 ,enableEventPropagation: false
//             };
// 
//             var ib = new InfoBox(myOptions);
//             boxList.push(ib);
// 
//             google.maps.event.addListener(marker,'click',(function(marker, i) {
//                 return function() {
//                     boxList[i].open(map, this);
//                 }
//             })(marker, i));
// 
//             google.maps.event.addDomListener(boxList[i].content_,'click',(function(marker, i) {
//                     return function() {
//                       alert('clicked ' + cityList[i][0])
//                     }
//                   })(marker, i));
//         } //endfor  
//     } //end function

</script>
  
<div class="meetings-body container">   
  <div class="row-fluid">
    <div class="meetings-listings-container span12">
      
        <div class="meetings-map-container">
          <div id="map-canvas" class="meetings-map-canvas"></div>
        </div>
      
        <div class="meetings-search-container">
            <%= form_tag meetings_path, :method => :get, class: "meetings-search-form navbar-form pull-left form-inline" do %>
              <!-- query -->
              <% if (params[:search]) %>
                <%= text_field_tag :search, params[:search], placeholder: "Search for a meeting in city, zipcode etc...", class: "input giant-input" %>
              <% else %>
                <%= text_field_tag :search, "", placeholder: "Search for a meeting in city, zipcode etc...", class: "input giant-input" %>
              <% end %>
            
              <%= submit_tag "Search", :name => nil, class: "giant-search-btn btn" %>
            <% end %>
        </div>
        
        <ul class="nav nav-tabs">
          <li class="<%= Time.now.monday? ? "active" : "" %>"><a href="#mon" data-toggle="tab">Mon</a></li>
          <li class="<%= Time.now.tuesday? ? "active" : "" %>"><a href="#tue" data-toggle="tab">Tue</a></li>
          <li class="<%= Time.now.wednesday? ? "active" : "" %>"><a href="#wed" data-toggle="tab">Wed</a></li>
          <li class="<%= Time.now.thursday? ? "active" : "" %>"><a href="#thu" data-toggle="tab">Thu</a></li>
          <li class="<%= Time.now.thursday? ? "active" : "" %>"><a href="#fri" data-toggle="tab">Fri</a></li>
          <li class="<%= Time.now.saturday? ? "active" : "" %>"><a href="#sat" data-toggle="tab">Sat</a></li>
          <li class="<%= Time.now.sunday? ? "active" : "" %>"><a href="#sun" data-toggle="tab">Sun</a></li>
        </ul>
        
        <div class="tab-content">
          <div class="tab-pane <%= Time.now.monday? ? "active" : "" %>" id="mon">
            <% unless @meetings_on_monday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_monday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
          <div class="tab-pane <%= Time.now.tuesday? ? "active" : "" %>" id="tue">
            <% unless @meetings_on_tuesday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_tuesday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
          <div class="tab-pane <%= Time.now.wednesday? ? "active" : "" %>" id="wed">
            <% unless @meetings_on_wednesday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_wednesday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
          <div class="tab-pane <%= Time.now.thursday? ? "active" : "" %>" id="thu">
            <% unless @meetings_on_thursday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_thursday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
          <div class="tab-pane <%= Time.now.thursday? ? "active" : "" %>" id="fri">
            <% unless @meetings_on_friday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_friday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
          <div class="tab-pane <%= Time.now.saturday? ? "active" : "" %>" id="sat">
            <% unless @meetings_on_saturday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_saturday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
          <div class="tab-pane <%= Time.now.sunday? ? "active" : "" %>" id="sun">
            <% unless @meetings_on_sunday.blank? %>
            <table class="meetings-listing-table table">
              <% @meetings_on_sunday.each do |meeting| %>
                <%= render 'listing', :meeting => meeting  %>       
              <% end %>
            </table>
            <% end %>
          </div>
        </div>
      

      
    </div>
    <!-- 
    <div class="meeting-preview-container span4 hidden-phone">
      <div id="meeting-preview" data-spy="affix" data-offset-top="200">
        <%# unless @meeting.blank? %>
          <script type="text/javascript">
            $(document).ready(function() {
              $('#meeting-preview').html('<%#= Helper.escape_js( render "meeting" ) %>');
            });
          </script>
        <%# end %>
      </div>
    </div>
     -->
  </div>

</div>